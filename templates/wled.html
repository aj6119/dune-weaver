{% extends "base.html" %} {% block title %}WLED - Kinetic Sand Table{% endblock %}

{% block additional_styles %}
/* Dark mode styles for WLED page */
.dark .bg-white {
  background-color: #262626;
}
.dark .border-slate-200 {
  border-color: #404040;
}
{% endblock %}

{% block content %}
<div class="layout-content-container flex flex-col w-full max-w-4xl gap-0 pt-2 pb-[75px]">
  <section class="bg-white rounded-xl shadow-sm overflow-hidden pt-4 sm:pt-0 h-full">
    <div class="flex flex-col items-center px-0 py-0 h-full">
      <div class="w-full h-full max-w-5xl flex flex-col overflow-hidden">
        <iframe id="wled-frame"
          src=""
          class="h-full w-full rounded-lg border border-slate-200"
          frameborder="0"
          allowfullscreen
        ></iframe>
      </div>
    </div>
  </section>
</div>
<script>
  async function loadWledIframe() {
    let wledIp = localStorage.getItem('wled_ip');
    const status = document.getElementById('wled-status');
    const frame = document.getElementById('wled-frame');
    if (!wledIp) {
      // Try to fetch from server if not in localStorage
      try {
        const resp = await fetch('/get_wled_ip');
        if (resp.ok) {
          const data = await resp.json();
          wledIp = data.wled_ip;
          localStorage.setItem('wled_ip', wledIp);
        }
      } catch (e) {}
    }
    if (wledIp && frame) {
      frame.src = `http://${wledIp}`;
      if (status) status.textContent = '';
    } else {
      if (frame) frame.src = '';
      if (status) status.textContent = 'No WLED IP set. Please set it in Settings.';
    }
  }
  document.addEventListener('DOMContentLoaded', loadWledIframe);
</script>
{% endblock %}
